# Vue 3 + TypeScript + Vite

2026.1.4 目前只写了前端相关工作
- 工作流执行函数的调试核心
- 写了三个工作流节点模板，可以参考写
- MainGraph.vue 是工作流的主图组件，vue-flow的graph操纵方法依赖这个组件的上下文，
- TestPanel.vue 是工作流的测试面板组件，用于调试工作流节点的执行函数,目前将执行逻辑大部分抽出到了/tool/streamManager.ts中
- /tool/streamManager.ts 是工作流执行函数的调试核心，包含了工作流节点的执行逻辑,还有各种类型检查，错误处理等，当前核心就是这个文件
- 注意查找运行节点的逻辑是协定查找类型为Start的节点，没这个节点就找不到工作流。
- 目前只实现了单线串行，没有并行、条件分支等复杂流程控制。
- /tool/nodeManager.ts 目前还没想好怎么写
- 定制节点需要定义和声明节点类型，然后传入vueFlow组件中，然后在写组件数据的时候会先尝试从type属性获取类型，否则为默认类型
- 目前写了三个简单的节点模板和节点类型（e_Add,e_Start,e_Output）

初版steamManager的构建思路

用于管理流中的节点和边. 适用于已经写好和连好线的单线程流.可以执行和单步调试

前置知识：
edge对象提供source和target属性，分别表示边的起始节点和目标节点的id edge提供了node 的id 但是edge不知道从哪找 对于一条连线来说一定有两个对应的端点，分别是source和target 对于一个节点来说，它可能有多个入边和多个出边. useVueFlow提供的方法不能在ts里面使用，他依赖Vue组件上下文，只能把要用的工具当参数传递 useVueFlow提供findNode方法，用于根据id获取node对象. useVueFlow提供findEdge方法，用于根据id获取edge对象. useVueFlow提供getEdges方法，用于获取当前状态下的所有连线. useVueFlow提供updateNodeData方法，用于更新节点数据.

考虑：
连线方式：目前先通过find next_edge.source === current_edge.target 来获取下一条连线实现单线串连.后续考虑优化为映射表.
filter可以实现多线，但是先不考虑
图表结构改变---也就是节点或边发生变化时，需要重新初始化流.不然不知道起点或者终点.
当前的起点判断是约定查找类型为start的节点
考虑把流控制器中的三个中间状态参数改成响应式，方便在外部监听和使用，渲染到页面上.
结束保护：当执行到输出节点时，停止执行，避免不停重复最后节点的执行和无限循环.
数据传递：连线中途需要携带数据包，数据包需要在节点之间传递，每个节点需要根据数据包进行处理，处理结果作为下一个节点的输入.
类型判断：如果节点携带的数据类型不一致，应该执行失败，而不是返回空

第二版nodeManager思路
程序想要跟着流程图跑，那么就得设计一套跟着图跑的逻辑 vueflow没有提供数据流传递的逻辑，那么只写一个数据流管理器就够了吗？ 不够，因为和图表的关联性不够，不好操作，只能找到一个中间节点 如果说流管理器靠图表配置，也就是写node对象，那么只能把node对象作为一个根逻辑，在此基础上进行添砖加瓦 打个比方，核心逻辑写好，然后流管理器按逻辑来运行，节点管理器按逻辑来变化，两者完全可以独立，一个控制动作，一个控制逻辑 所以想要写一套可以逻辑简单的生成输入，输出组件的节点管理器，其不走就应该是，先写好输入输出逻辑，流管理器负责依据这些逻辑运行，节点管理器根据要求渲染，控制样式的变化 所以问题是怎么写一个用户创建组件，然后自动生成好这个node对象逻辑 试想用户要写一个自定义节点，这也是工作流必须要有的一个节点类型 这个节点的外观嗯，可以很简单，后续可以考虑外观也自定义 这个节点至少得有确定关系的逻辑,貌似不需要节点考虑自己链接了多少个其他节点，因为节点的关系用边就可以唯一确定 因为边只有一个target 和 source，所以节点的关系用边就可以唯一确定 那么数据的传递其实是依赖边进行传递的， 有没有必要设计一个节点有多个输入和输出的逻辑呢？有 如果说把节点看成一个函数，那么节点的输入和输出就可以用函数的参数和返回值来表示，除了输入节点这边不建议带动态数据，默认数据看需求 那么其实完全可以就把节点Id和他的动作函数做一个映射，根本不需要用到其他逻辑 所以完全可以写一个创建某个节点时记录节点的动作函数，然后根据边的关联，依次执行就可以了 那么会不会出现一些怪问题呢？比如需不需要考虑多线程，同时运行，一个核心节点需要接受参数，会不会不同时到达节点，那么节点的运行逻辑是什么？ 貌似当时工作流设计的时候就没有考虑多线程的问题吧，都是按顺序执行，那么其实完全可以就把程序从上到下执行一遍就可以了 甚至写的时候可以没有顺序，因为考虑按边来顺序执行

好的，那么现在的思路是把动作和样式独立出来， 动作流写的形式就是写一个id:函数映射表 输入节点带数据，默认不带函数，或者带一个占位函数，返回数据 中间节点携带动作函数，只接受一个输入边，返回一个输出边，如果有循环控制就在侧面加边，一个句柄只连一条线 输出节点接受数据，函数就是更新节点的样式，将数据渲染出来，或者有其他不需要改样式的输出方法，给出一些提示这样 执行逻辑就是查到第一个节点，以这个节点为起点，查链接这个节点的边，然后找到下一个节点，然后执行下一个节点带的逻辑

那么现在可以回答怎么写一个自定义节点了，首先需要自定义节点类型（输入/中间/输出），定义完毕出现相应样式的改变 然后需要定义输入的类型，（字符/数字/对象/数组/布尔值） 或者不需要查类型？直接让用户写函数，反正大不了报错或者undefined,让他自己取debug，那么需要可能做一些提示告诉他怎么写

那么到底要不要所谓的节点管理器呢？ 貌似不需要了，因为useVueflow已经提供了一些方法，然后如果我要改样式，我可以把这个逻辑写到节点的动作函数中 所以现在的其实就开发一个辅助创建节点的同时，把id函数映射表同时记录下来 嗯，设想用户面对空空的表，肯定要加节点，那肯定不能让他编那个根json ,这很反人性 所以其实应该提前把所有节点逻辑写好，然后只需点点点按钮就能加节点，然后是自定义节点

来到开发问题上，那我们开发的时候应该怎么组织代码呢？ 首先是节点管理器面板，没有面板开发也不好测试，同时还需要给面板注入对应逻辑 然后是调试面板，控制执行逻辑，需要能找到起点，找到下一个节点，然后执行函数，单步执行功能 执行逻辑这一块，不如写一个状态管理器，比如addNode只是addNode到状态管理器，我想在addNode的同时就把起点确定 然后addEdges时就把id函数表给生成出来 执行的时候顺着id函数表走就行，适当在函数里面加一些样式改变函数，这样更直观

怎么解决编辑图表的时候的运行问题？要求有个编辑状态，编辑完成才可以运行

1.24开发日志

删除了streamManager，因为他的功能现在已经被nodeManager取代了,同时删除与streamManager绑定的testPanel,后续有需要会考虑重新再写一个调试面板

后端设计思路
考虑先搭建一个建议框架，设计几个简单api，使用gee核心框架，后续再根据需求添加功能
想了一下不如从业务起手，跑通一个基本业务流程

1.影像获取
2.影像处理
3.数据提取
4.数据可视化

emm，今天就尝试实现小块png影像上传+yolo模型预测，返回预测结果

上传组件：考虑用element-plus提供的上传组件不反复造轮子
使用element-plus提供的组件需要安装对应依赖，最好装两个插件用于自动导入样式
